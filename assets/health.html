<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AstriaGraph health check</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    h1 { font-size: 20px; margin-top: 0; }
    table { border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 8px 12px; }
    th { background: #f5f5f5; text-align: left; }
    .ok { color: #0a0; font-weight: 600; }
    .err { color: #a00; font-weight: 600; }
    code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
  </style>
</head>
<body>
  <h1>AstriaGraph health check</h1>
  <p>This page verifies that the static TSV files are reachable from GitHub Pages and reports basic status.</p>
  <table>
    <thead>
      <tr><th>Resource</th><th>URL</th><th>Status</th><th>Notes</th></tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>

  <script>
    (async function() {
      const rows = document.getElementById('rows');
      const resources = [
        { name: 'Data sources', url: '../assets/data/www_data_sources.tsv' },
        { name: 'Objects (NODEB)', url: '../assets/data/www_query_NODEB.tsv' },
        { name: 'Objects (DEB)', url: '../assets/data/www_query_DEB.tsv' },
        { name: 'Origins CSV', url: '../origins.csv' }
      ];

      function addRow(name, url, status, notes, ok) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${name}</td>
          <td><code>${url}</code></td>
          <td class="${ok ? 'ok' : 'err'}">${status}</td>
          <td>${notes || ''}</td>
        `;
        rows.appendChild(tr);
      }

      for (const r of resources) {
        try {
          const res = await fetch(r.url, { cache: 'no-store' });
          const ok = res.ok;
          let notes = '';
          if (ok) {
            const text = await res.text();
            notes = `bytes: ${text.length}`;
          } else {
            notes = `HTTP ${res.status}`;
          }
          addRow(r.name, r.url, ok ? 'OK' : 'ERROR', notes, ok);
        } catch (e) {
          addRow(r.name, r.url, 'ERROR', e && e.message ? e.message : 'Network error', false);
        }
      }

      // Also report data mode detection logic like the app
      const mode = (typeof window !== 'undefined' && window.ASTRIAGRAPH_API_BASE && String(window.ASTRIAGRAPH_API_BASE).trim().length)
        ? `Live API (${window.ASTRIAGRAPH_API_BASE})` : 'Static data (assets/data/*.tsv)';
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>Data mode</td><td><code>window.ASTRIAGRAPH_API_BASE</code></td><td>Info</td><td>${mode}</td>`;
      rows.appendChild(tr);
    })();
  </script>
</body>
</html>
